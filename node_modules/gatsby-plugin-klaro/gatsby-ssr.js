"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _react = _interopRequireDefault(require("react"));

var DEFAULT_VERSION = "v0.7.11";
var DEFAULT_URL = "https://cdn.kiprotect.com/klaro/%version%/klaro.js";

exports.onRenderBody = function (_ref, pluginOptions) {
  var setHeadComponents = _ref.setHeadComponents;

  if (process.env.NODE_ENV === "production" || pluginOptions.includeInDevelopment) {
    var klaroComponents = [];
    var klaroVersion = pluginOptions.klaroVersion,
        klaroUrl = pluginOptions.klaroUrl,
        config = pluginOptions.config,
        configUrl = pluginOptions.configUrl; // Prepare config

    var configurationComponent;

    if (configUrl !== undefined) {
      configurationComponent = /*#__PURE__*/_react.default.createElement("script", {
        defer: true,
        key: "klaro-config",
        type: "text/javascript",
        src: configUrl
      });
    }

    if (config !== undefined) {
      var configAsString = "window.klaroConfig = " + JSON.stringify(config);
      configurationComponent = /*#__PURE__*/_react.default.createElement("script", {
        key: "klaro-config",
        type: "text/javascript",
        dangerouslySetInnerHTML: {
          __html: "" + configAsString
        }
      });
    }

    if (configurationComponent !== undefined) {
      klaroComponents.push(configurationComponent);
    } // Prepare Klaro


    var urlToUse = klaroUrl ? klaroUrl : DEFAULT_URL;
    var versionToUse = klaroVersion ? klaroVersion : DEFAULT_VERSION;
    var finalKlaroUrl = urlToUse.replace("%version%", versionToUse);

    var urlComponent = /*#__PURE__*/_react.default.createElement("script", {
      defer: true,
      key: "klaro",
      type: "text/javascript",
      src: finalKlaroUrl
    });

    klaroComponents.push(urlComponent); // Add components

    return setHeadComponents(klaroComponents);
  }

  return null;
};